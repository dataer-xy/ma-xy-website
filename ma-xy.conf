
# /etc/nginx/nginx.conf
user root;
# worker_rlmit_nofile 65500; # 提升nginx的进程文件打开数
# worker_processes 1;  # 开启一个 nginx 工作进程,一般 CPU 几核就写几
# pid /run/nginx.pid;  # pid 路径

# 事件模块配置
events {

    worker_connections  1024; # 一个worker最大的链接数量

    # use epool; #使 用的网络模型为 epool 默认

}

# http 模块配置
http{
    include  mime.types; # 不需要了 启动之前，要将/etc/nginx/mime.types文件复制到该nginx.conf所在目录，并且必须使用绝对路径）

    # sendfile  on; # 不需要了 启用高效文件传输 nginx内部提供的方法

    keepalive_timeout  65; # 不需要了 会话超时时间

    # gzip  on; # 是否开启压缩功能

    # proxy_connect_timeout 10;
    # proxy_read_timeout 180;
    # proxy_send_timeout 5;
    # proxy_buffer_size 16k;
    # proxy_buffers 4 32k;
    # proxy_busy_buffers_size 96k;
    # proxy_temp_file_write_size 96k;
    # proxy_temp_path /tmp/temp_dir;
    # proxy_cache_path /tmp/cache levels=1:2 keys_zone=cache_one:100m inactive=1d max_size=10g;


    # 反向代理
    upstream dataset-xy-server {
        server 127.0.0.1:8091; # dataset-xy服务所在的端口
    }


    # ma-xy 服务
    server{
         
        listen 80;
        
        # sever name
        server_name www.ma-xy.com;
        
        # charset
        charset utf-8;

        root /home/syy/projects/ma-xy-website; # 网站所在路径 root 字段最好写在 location 字段的外边，防止出现无法加载 css、js 的情况

        # access_log  /home/syy/projects/ma-xy-website/log/nginx-access.log; # 服务器接收的请求日志，logs目录若不存在需要创建，否则nginx报错
        # error_log  /home/syy/projects/ma-xy-website/log/nginx-error.log; # 错误日志
        
        location /static {
            alias /home/syy/projects/ma-xy-website/;
        }

        location / { 
            index index.html index.htm; # 默认的首页文件
            
        }

    }

    # dataset-xy 服务
    server{
        # 暴露给外部的端口 nginx一直监听这这里
        listen 80; # 默认的web访问端口
        
        # sever name
        server_name www.dataset-xy.com;
        
        # charset
        charset utf-8;

        # root /home/syy/projects/ma-xy-website; # 网站所在路径 root 字段最好写在 location 字段的外边，防止出现无法加载 css、js 的情况

        # access_log  /home/syy/projects/ma-xy-website/log/nginx-access.log; # 服务器接收的请求日志，logs目录若不存在需要创建，否则nginx报错
        # error_log  /home/syy/projects/ma-xy-website/log/nginx-error.log; # 错误日志
        
        # location /static {
        #     alias /home/syy/projects/ma-xy-website/;
        # }

        location / { 
            proxy_pass http://dataset-xy-server;
            proxy_redirect     off;

            proxy_set_header Host $host;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP        $remote_addr;
            proxy_set_header X-NginX-Proxy true;
            

        }

    }


}





